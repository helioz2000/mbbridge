// mbbridge configuration file

// This value determines the granularity of the measuring system
mainloopinterval = 250;		// [ms]

// MQTT parameters
mqtt = {
	broker = "127.0.0.1";
	debug = false;			// only works in command line mode
};

// read and publish cpu temperature
cputemp = {
	topic = "binder/home/mqtt/pi/cpu/temp";
	readinterval = 5;
	publishinterval = 5;
};

// Modbus RTU interface configuration
// only one interface device is allowed
modbusrtu = {
	device = "/dev/ttyUSB0";		// mandatory
	baudrate = 1200;				// mandatory
// optional parameters:
	responsetimeout_us = 500000;	// useconds
	responsetimeout_s = 0;			// seconds
	debug = false;					// only work when not in daemon mode
	debuglevel = 1;					// 1 = this app, 2 = modbus library
};

// Updatecycles definition
// every modbus tag is read in one of these cycles
// id - a freely defined unique integer which is referenced in the tag definition
// interval - the time between reading, in seconds
updatecycles = (
	{
	id = 1;
	interval = 10;	// seconds
	},
	{
	id = 2;
	interval = 20;
	},
	{
	id = 3;
	interval = 30;
	},
	{
	id = 6;
	interval = 60;
	},
	{
	id = 12;
	interval = 120;		// 2 minutes
	},
	{
	id = 30
	interval = 300;		// 5 minutes
	},
	{
	id = 60;
	interval = 600;		// 10 minutes
	},
	{
	id = 180;
	interval = 1800;	// 30 minutes
	}
)

// Modbus Slaves
// definition of every modbus slave and it's associated tags
// name = a freely definable name
// id = the modbus slave RTU address
// enabled = true or false to disable (ignore) any tags in slave
// tags = a list of tag definitions to be read at the indicated interval
//
// tag parameter description:
// address = the holding register address of the tag in the modbus device
// update_cycle = the id of the cycle for updating and publishing this tag
// topic = mqtt topic under which to publish the value, en empty string will revent pblishing
// format = printf style format for mqtt publication, NOTE: all values are type "float"
// multiplier = raw value will be multiplied by this factor
// offset = value to be added after above multiplication
mbslaves = (
	{
	name = "board 30";
	id = 30;
	enabled = TRUE;
	tags = 
		(
			{
			address = 100;
			update_cycle = 1;		// as per "updatecycles" configuration
			topic = "binder/home/test/a100";
			format = "%.0f"
			multiplier = 1.0;
			offset = 0.0;
			},
			{
			address = 101;
			update_cycle = 3;
			topic = "binder/home/test/a101";
			format = "%.0f"
			multiplier = 1.0;
			offset = 0.0;

			}
		)
	},
	{
	name = "board 30-2"
	id = 30;
	enabled = TRUE;
	tags = 
		(
			{
			address = 105;
			update_cycle = 1;		// as per "updatecycles" configuration
			topic = "binder/home/test/a105";
			format = "%.0f"
			multiplier = 1.0;
			offset = 0.0;

			}
		);
	}
)
